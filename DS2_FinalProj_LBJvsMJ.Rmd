---
title: "How Different are LeBron James and Michael Jordan?"
author: "Levi C. Nicklas"
date: "11/29/2018"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

knitr::opts_chunk$set(tidy.opts=list(width.cutoff=40),tidy=TRUE)
```


## How Different are LeBron James and Michael Jordan?

Among the hottest topics in basketball is always: "Who is the G.O.A.T (Greatest of All Time)?"

Although other names such as Bill Russell, Kareem Abdul-Jabar, Magic Johnson, or Kobe Bryant come up in some debates, LeBron James and Michael Jordan typically top the list and have the most compelling arguments. Although the "eye test" of play styles often results in the conclusion that MJ is a score-first player and that LeBron is a pass-first player, they both put up somewhat similar stat lines through out their careers. Both are excellent, above average, scorers, rebounders, passers, and defenders. It is for this reason I want to examine if, according to numbers, that MJ and LBJ are so similar that it's pointless to compare them, that they are so different that they should not be compared, or perhaps somewhere in between.

Throughout this brief study of the players' game stat lines, I will conduct an exploratory data analysis (EDA), model LeBron's career decline as he ages, and use machine learning models to see if when blinded to the player a computer can use a stat line to distinguish the two.

The data used for this project is from kaggle(compiled from, the reputable nba stats repository, nba-reference.com). 
https://www.kaggle.com/edgarhuichen/nba-players-career-game-log 


```{r, echo=FALSE, error=FALSE, message=FALSE}
#LIBRARIES USED:

library(tidyverse) 
library(stringr)        #data cleaning.
library(corrplot)       #EDA Correlation of variables plot
library(mlbench)        #can't remember if actually used or not.
library(randomForest)   #modelling.
library(pROC)           #ROC curve; model performance.
library(magrittr)       #Used in ROC Curve plotting. "%$%"
library(rsample)        #Used for cross validation.

```

### Data Cleaning and Organization.
The data set(s) are two .csv files containing 1072 observations for Jordan and 1132 observations for James; the data sets were appended to one another to form one data set of 2204 observations. Each observation in the data set is the player's name, team opponent, point margin, and individual statistics for a game of their careers.  


Changes made to the data sets:

  1.) Add the player's name to their dataset as a new column.
  
  2.) Remove date, age, teams, game score, result (W/L), and minutes played.
  
  3.) Create a new variable, "point differential".
  
  4.) Omit plus-minus variable.
  
  5.) Reorder to logical order.
  
  
Firstly, the player's names are needed for oraganization after merging the data, but also for supervised machine learning later in the project. 

Secondly, I removed many variables from the data set. Date is removed for obvious reasons, a decision tree with one split for date, "is the date before 2003",  would get 100% accuracy. Age is also omitted because Jordan retired, twice, and these gaps may be obvious for a model to observe. game score and result are removed simply because they are both used, or captured, by the point differential variable. The game score is also not included due to trends in each player's careers: during Jordan's career, the NBA average points scored in a game was decreasing, whereas in James' career the average points scored in a game has been rising. I feared this trend would also be easily noticed by the model, and since it is largely not due to the player, but the league at the time, it was removed. 

Lastly, plus-minus (the point differential for the only the minutes the player spent on the court), was not recorded for most of Jordan's career so it was removed.

```{r, echo=FALSE, error=FALSE}
#Clean and Organize data.
lebron_career_orig<-read.csv("nba-players-career-game-log/lebron_career.csv")


lebron_career<-lebron_career_orig %>% 
  mutate(player="LBJ")   #Add player identifier into dataset.
lebron_career<-lebron_career[,-c(4,5,25)] #remove these stats (date, age, team, and game score).
lebron_career<-lebron_career[,c(24,1,2,3,4,5,6,7,8,9,10,11,12,
                                13,14,15,16,17,18,19,20,21,22,23)] #reorder played ID to first column.
lebron_career<-lebron_career %>% 
  mutate(pt_diff=as.numeric(
    substring(result,nchar(as.character(result))-
                2,nchar(as.character(result))-1))) #get point differential from "result".
lebron_career<-lebron_career %>% 
  mutate(W_L=substring(result,1,1)=="W")

lebron_career<-lebron_career[,c(1,2,3,25,24,4,5,6,7,8,9,10,
                                11,12,13,14,15,16,17,18,19,
                                20,21,22,23,24,25,26)]#reorder.
lebron_career<-lebron_career[-c(7,8)]#remove "result" and "mp".
lebron_career<-lebron_career[-c(5,24)]#remove +/-, not kept for all of MJ's games.
```

```{r, echo=FALSE, error=FALSE}
#Clean and Organize data.
jordan_career_orig<-read.csv("nba-players-career-game-log/jordan_career.csv")

jordan_career<-jordan_career_orig %>% 
  mutate(player="MJ")#Add player identifier into dataset.
jordan_career<-jordan_career[,-c(4,5,25)] #remove these stats (date, age, team, and game score).
jordan_career<-jordan_career[,c(24,1,2,3,4,5,6,7,8,9,10,11,12,
                                13,14,15,16,17,18,19,20,21,22,23)] #reorder played ID to first column.
jordan_career<-jordan_career %>% 
  mutate(pt_diff=as.numeric(
    substring(result,nchar(as.character(result))-
                2,nchar(as.character(result))-1))) #get point differential from "result".
jordan_career<-jordan_career %>% 
  mutate(W_L=substring(result,1,1)=="W")

jordan_career<-jordan_career[,c(1,2,3,25,24,4,5,6,7,8,9,10,
                                11,12,13,14,15,16,17,18,19,
                                20,21,22,23,24,25,26)]#reorder.
jordan_career<-jordan_career[-c(7,8)] #remove "result" and "mp".
jordan_career<-jordan_career[-c(5,24)]#remove +/-, not kept for all of MJ's games.
```

```{r, echo=FALSE, error=FALSE}
#bind the datasets
goat_games<-bind_rows(jordan_career,lebron_career) #need to make NA vals = 0.
goat_games<- goat_games %>% 
  mutate(threep=round(three/threeatt,3))
#fix threep. Previously was a string, simply recalculated to 3 decimals.
goat_games<-replace(goat_games,is.na(goat_games), 0) #replace NA w/ 0
```

###Exploratory Data Analysis

For my EDA, my goal was to not only produce some pretty graphs which display useful information, but to also see if we can locate those NBA stat categories which may contain a large disparity between the two players. I was interested to see if our conclusions about what makes MJ and LBJ same/different was similar, or close to, what my machine learning model(s) would come up with.

First I checked to see if any variables were strongly correlated, to avoid colinearity. However, it seems only those stats which are proportions or sums of other stats are strongly correlated, i.e. defensive rebounds and total rebounds, field goals and points, three pointers attempted and three pointers made, etc. So I proceeded with good confidence in my variable choice thus far.
```{r, echo=FALSE, error=FALSE}
goat_games[,-c(1,3,5,23)] %>% 
  cor() %>% 
  round(3) %>% 
  corrplot(type="upper", order= "hclust", tl.col="black",tl.srt=45)
  
```

Nothing out of the ordinary has strong colinearity, so we will proceed with thess categories.

```{r, echo=FALSE, error=FALSE}
goat_games %>% 
  group_by(player) %>% 
  ggplot(aes(pts, fgp, color=player))+
  geom_density_2d()+
  scale_color_brewer(type="qual", palette = 6)+
  ggtitle("Density of Field Goal Percentage (FG%) as a function of Points (PTS)")+
  ylab("FG%")+xlab("PTS")
```

Here we see that MJ scores a lot more than LeBron, but sometimes at the cost of efficiency. LeBron is quite efficient, but has a lot less of the thrilling 50+ point games.

```{r, echo=FALSE, error=FALSE}
goat_games %>% 
  group_by(player) %>% 
  ggplot(aes(ast,tov,color=player))+
  geom_density_2d()+
  #geom_jitter(alpha=0.3)+
  scale_color_brewer(type="qual", palette = 6)+
  ggtitle("Density of Turnovers (TOV) as a function of Assists (AST)")+
  ylab("TOV")+xlab("AST")
```

We see here that LeBron's passes the ball a lot more, based ont he fact that he gets more assists and more turnovers, whereas MJ has less assists and less turnovers.

```{r, echo=FALSE, error=FALSE}
library(reshape2)
#Melt data into player, variable, and value.
melted_goat<-melt(as.data.frame(goat_games),id.vars = "player", 
                  measure.vars = c("pt_diff","fg","fga","fgp","three","threeatt",
                                   "threep","ft","fta","ftp","orb","drb","trb","ast",
                                   "stl","blk","tov","pts")) 

#Plot the data by variable to compare the players.
melted_goat %>% 
  group_by(player) %>% 
  ggplot(aes(factor(variable), value, color=player)) + 
  geom_boxplot() + 
  facet_wrap(~variable, scale="free")+
  scale_color_brewer(type="qual", palette = 6)+
  ggtitle("Comparison of Distributions of Various Player Career Statistics" )+
  xlab("variables")+ylab("value")
  
```



###LeBron's Decline

An important part of this analysis/project, is the fact that while Michael Jordan's career has concluded, LeBron is just entering his decline. Many sports journalist still belive LeBron is in his prime or just beginning to show signs of slowing down. For this reason, I want to model his decline, and even (CHECK THAT YOU ACTUALLY DID THIS) simulate some data to fill up the remainder of LeBron's career. Then we will check how this affected the model by feeding in the simulated LeBron data as well. 

####How Rapid of a Decline?

A stat that we can model as a function of time is Efficiency. Efficiency, the NBA statistic, is a bit of a misnomer as it doesn't measure anything like shooting efficiency, but it is in fact a composition of the stat categories we examined in the EDA.


$$Efficiency = (PTS + REB + AST + STL + BLK - Missed FG - Missed FT - TO)$$


```{r, echo=FALSE, error=FALSE}
goat_games_eff<-goat_games %>% 
  mutate(game_eff = pts + ast + trb + stl + blk - (fga-fg) - (fta-ft) - tov)

goat_games_eff %>% 
  group_by(player) %>% 
  ggplot(aes(player,game_eff, color= player))+
  geom_boxplot()+geom_jitter(alpha=0.1)+
  ggtitle("Distribution of Player Efficiency by Game")+
  ylab("Efficiency")+xlab("Player")+
  scale_color_brewer(type="qual", palette = 6)
  
```

These look awfully similar. LeBron is slightly more consistent, but has a handful of outlier good/bad games. MJ is slightly less consistent, but has some very high outlier games.

```{r, echo=FALSE, include=TRUE, error=FALSE}
library(lubridate)



goat_games_eff %>% 
  filter(player=="MJ") %>% 
  mutate(date_shift=as.numeric(date)+77) %>% 
  #NOTICE APPLIED SHIFT... Just to fit NBA season in one year for facet wrap.
  mutate(age_days= as.numeric(substr(age,1,2))*365+as.numeric(substr(age,4,6)) )%>% 
  ggplot(aes(age_days,game_eff))+
  geom_point()+
  geom_smooth(method="loess")+
  ggtitle("Jordan Efficiency as a function of Time")+
  ylab("Efficiency")+xlab("Age in Days")+
  scale_x_continuous(limits=c(6500,15000))

goat_games_eff %>% 
  filter(player=="LBJ") %>% 
  mutate(date_shift=as.numeric(date)+77) %>% 
  #NOTICE APPLIED SHIFT... Just to fit NBA season in one year for facet wrap.
  mutate(age_days= as.numeric(substr(age,1,2))*365+as.numeric(substr(age,4,6)) )%>% 
  ggplot(aes(age_days,game_eff))+
  geom_point()+
  geom_smooth(method="loess")+
  ggtitle("LeBron Efficiency as a function of Time")+
  ylab("Efficiency")+xlab("Age in Days")+
  scale_x_continuous(limits=c(6500,15000))




```

Okay, so LeBron is... getting better? Maybe we are about to witness a career of continued individual success into a late age, but most likely not. So we will assume that the last season in the data set was LeBron's peak. 

Since modeling his decline will be much more involved than time allows, we will go another direction.

###Random Forest Model

Using a random forest model will enable us to classify stat lines as Jordan or LeBron. The hope is that this can then be used to classify players who are "like Jordan or "like LeBron". We will consider Ben Simmons and Kobe Bryant to be classified. 

```{r,echo=FALSE, error=FALSE}
set.seed(23)
samplesize<-round(nrow(goat_games)*0.75,0)
train_ind<-sample(seq_len(nrow(goat_games)),samplesize,replace=FALSE)
train_set <- goat_games[train_ind, ] #remove splitting index
test_set <- goat_games[-train_ind, ] #remove splitting index


train_set$player<-factor(train_set$player)
train_set<-train_set[-c(3,5)]

test_set$player<-factor(test_set$player)
test_set<-test_set[-c(3,5)]
```


```{r, echo=FALSE, error=FALSE}
#Train Model
mod0 <- randomForest(player ~ . , data = train_set,
                     ntree = 300, mtry = 10) #train on 10 vars, 300 trees

mod0 #look at confusion matrix

plot(mod0,
     main= "Error from Estimation by Number of Trees", 
     sub="Training Data")

#Check how important different vars are
vars_importance<-importance(mod0) %>% 
  as.data.frame() %>% #save MeanDecreaseGini Scores for Vars
  rownames_to_column() %>% 
  arrange(desc(MeanDecreaseGini)) 
#Note to self... had to restart r. Some packages may have conflicted.
```

```{r, echo=FALSE, error=FALSE}
predict(mod0, test_set, type="response")
prediction_probabilities_points<-as.data.frame(predict(mod0, test_set, type="prob")) 
#view prediction probabilites

prediction_probabilities_points %>% 
  ggplot(aes(LBJ))+
  #geom_histogram()+
  geom_density()+ #view probabilities of model's certainty.
  ggtitle("Model Prediction Probabilities on Test Set")


prediction_probabilities_points %>% 
  ggplot(aes(MJ))+
  #geom_histogram(binwidth = 0.02)+
  geom_density()


player_probs<- mod0 %>% 
  predict(newdata= train_set,type="prob") %>% 
  as.data.frame() #should reformat as colnames <- c(player, probability) ...  
#could use in other plots to understand.
```

```{r, echo=FALSE, error=FALSE}
#Train ROC Curve
ROC_obj_train<-train_set %>% 
  mutate(.fitted = predict(mod0, newdata = train_set, type = "prob")[,2]) %$% #dont run 2nd line for the 
                                                                              #fitted boxplot to work.
  roc(player, .fitted, plot = TRUE, legacy.axes = TRUE, asp = NA) 

#ROC_obj_train %>% 
  #ggplot(aes(player,.fitted))+geom_boxplot()+geom_jitter(alpha=0.05) #fitted vals for training data.

#Test ROC Curve
ROC_obj_test<-test_set %>% 
  mutate(.fitted = predict(mod0, newdata = test_set, type = "prob")[,2]) %$% #dont run 2nd line for the 
                                                                             #fitted boxplot to work. 
roc(player, .fitted, plot = TRUE, legacy.axes = TRUE, asp = NA) 

#ROC_obj_test %>% 
  #(aes(player,.fitted))+geom_boxplot() #fitted vals for test data.       

#UNCOMMENT THESE ^ TO SEE BOXPLOT OF FITTED VALUES (lines 318 and 327).
```


```{r, echo=FALSE, error=FALSE}


#Ben Simmons
ben_simmons<-as.data.frame(t(c(12,1,9,16,0.563,0,0,0,4,6,0.667,3,6,9,13,2,3,3,22,2,TRUE)))
ben_simmons$player<-"BenSimmons"
ben_simmons<-ben_simmons[,c(22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)]

single_line<-colnames(goat_games)
single_line<-single_line[-c(3,5)]
colnames(ben_simmons)<-single_line

predict(mod0, ben_simmons, type="response")
ben_simmons_predictions<-as.data.frame(predict(mod0, ben_simmons, type="prob")) 
#view prediction probabilites

#Kobe Bryant
kobe<-as.data.frame(t(c(11,12,12,26,0.462,4,5,0.8,6,8,0.75,1,1,2,5,0,0,2,34,15,TRUE)))
kobe$player<-"KobeBryant"
kobe<-kobe[,c(22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)]

single_line<-colnames(goat_games)
single_line<-single_line[-c(3,5)]
colnames(kobe)<-single_line

predict(mod0, kobe, type="response")
kobe_predictions<-as.data.frame(predict(mod0, kobe, type="prob")) 
#view prediction probabilites

```

###Conclusions

This model is very good at predicting whether a stat line is Jordan's or LeBron's, however extending its predictions to other players was foolish. This is because the model puts so much stock in how the player shoots the three point shot. Kobe, who really plays like Jordan, is classified as LeBron largely because they played in eras where shooting a higher volume of three shots was more commonplace and acceptable. Likewise, Ben Simmons, who is a facilitator like LeBron, is placed as Jordan simply because he is bad at shooting threes and doesn't do it often.




