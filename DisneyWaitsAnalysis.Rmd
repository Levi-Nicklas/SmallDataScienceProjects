---
title: "Disney Wait Times"
author: "Levi C. Nicklas"
date: "6/4/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
```

```{r Read In Data, message = FALSE}
sevendwarfs <- read_csv("DisneyData/7_dwarfs_train.csv")
alien_saucers <- read_csv("DisneyData/alien_saucers.csv") 
dinosaur <- read_csv("DisneyData/dinosaur.csv")
everest <- read_csv("DisneyData/expedition_everest.csv")
flight_passage <- read_csv("DisneyData/flight_of_passage.csv")
safari <- read_csv("DisneyData/kilimanjaro_safaris.csv")
navi <- read_csv("DisneyData/navi_river.csv")
pirates <- read_csv("DisneyData/pirates_of_caribbean.csv")
rocknroller <- read_csv("DisneyData/rock_n_rollercoaster.csv")
slinky <- read_csv("DisneyData/slinky_dog.csv")
soarin<- read_csv("DisneyData/soarin.csv")
spaceship_earth <- read_csv("DisneyData/spaceship_earth.csv")
splash_mtn <- read_csv("DisneyData/splash_mountain.csv")
toystory <- read_csv("DisneyData/toy_story_mania.csv")

meta_data <- read_csv("DisneyData/metadata.csv")
```

```{r Tidying and Joining}
sevendwarfs$attraction <- "sevendwarfs"
alien_saucers$attraction <- "alien_saucers"
dinosaur$attraction <- "dinosaur" 
everest$attraction <- "everest" 
flight_passage$attraction <- "flight_passage" 
safari$attraction <- "safari"
navi$attraction <- "navi"
pirates$attraction <- "pirates"
rocknroller$attraction <- "rocknroller"
slinky$attraction <- "slinky"
soarin$attraction <- "soarin"
spaceship_earth$attraction <- "spaceship_earth" 
splash_mtn$attraction <- "splash_mtn"
toystory$attraction <- "toystory"

#Append Data
ride_waits <- rbind(
  sevendwarfs, alien_saucers, dinosaur, everest,
  flight_passage, safari, navi, pirates,
  rocknroller, slinky, soarin, spaceship_earth,
  splash_mtn, toystory
) %>% 
  mutate( min_of_time = minute(datetime),
          hour_of_time = hour(datetime)
  )

#Remove extra dfs
remove(
  sevendwarfs, alien_saucers, dinosaur, everest,
  flight_passage, safari, navi, pirates,
  rocknroller, slinky, soarin, spaceship_earth,
  splash_mtn, toystory
)
```


```{r EDA Wait Times}
# Check ride 5 num sum. for posted times
ride_waits %>% 
  drop_na(SPOSTMIN) %>% 
  filter(SPOSTMIN != -999) %>% 
  group_by(attraction) %>% 
  summarize(
    mean(SPOSTMIN),
    sd(SPOSTMIN),
    median(SPOSTMIN),
    min(SPOSTMIN),
    max(SPOSTMIN)
  )

# Change date to a Date data type for easy handling.
ride_waits$date <- as.Date(ride_waits$date, "%m/%d/%Y")

ride_waits %>% 
  drop_na(SPOSTMIN) %>%           # Drop NA values
  filter(SPOSTMIN != -999) %>%    # Remove -999 values (temporarilty closed.)
  group_by(attraction,date) %>% 
  summarize(avg_wait = mean(SPOSTMIN)) %>% 
  ggplot(aes(date, avg_wait, group = 1))+
  geom_line() + facet_wrap(~attraction)

ride_waits %>% 
  drop_na(SACTMIN) %>% 
  filter(SACTMIN != -999) %>% 
  filter(SACTMIN < 600 & SACTMIN > 0) %>% 
  group_by(attraction,date) %>% 
  summarize(avg_wait_act = mean(SACTMIN)) %>% 
  ggplot(aes(date, avg_wait_act, group = 1))+
  geom_line() + facet_wrap(~attraction)


gathered_ride_waits <- ride_waits %>% 
  gather (SPOSTMIN, SACTMIN, key = ACT_or_POST, value = "wait")

# Actual vs Posted Time Series.
gathered_ride_waits %>% 
  drop_na(wait) %>% 
  filter(wait < 600 & wait > 0) %>% 
  group_by(attraction,date, ACT_or_POST) %>% 
  summarize(avg_wait = mean(wait)) %>% 
  ggplot(aes(date, avg_wait, color = ACT_or_POST))+
  geom_line(alpha = 0.75)+
  facet_wrap(~attraction)+
  scale_color_manual(values=c("red", "black"))

# Do Year facet wrap for one ride.
gathered_ride_waits %>% 
  drop_na(wait) %>% 
  filter(wait < 600 & wait > 0) %>% 
  filter(attraction == "safari") %>% 
  mutate(year = year(date),
         day_of_year = yday(date)) %>% 
  group_by(year, day_of_year, ACT_or_POST) %>% 
  summarize(avg_wait = mean(wait)) %>% 
  ggplot(aes(day_of_year, avg_wait, color = ACT_or_POST))+
  geom_line(alpha = 0.75)+
  facet_wrap(~year)+
  scale_color_manual(values=c("red", "black"),
                     name = "Actual or Posted",
                     labels = c("Actual", "Posted"))+
  ggtitle("Kilimanjaro Safari Wait Times")

# Most down rides
ride_waits %>% 
  group_by(attraction) %>% 
  filter(SPOSTMIN == -999) %>% 
  count(name = "downed") %>% 
  ggplot()+
  geom_col(aes(x = reorder(attraction, -downed),downed), fill = "purple", color = "white")+
  xlab("Number of Times Down")+
  ylab("Attraction")+
  coord_flip()
```

```{r Metadata}
#colnames(meta_data)

#t(head(meta_data)) # Easier to read once transposed.

# Be sure to review Data Dictionary!

```


### Kilimanjaro Safaris

Kilimanjaro Safaris, in Disney's Animal Kingdom, seems to post higher wait times than the actual wait is (along with every other ride shown above). Our question is: is the mean posted wait different from the mean true wait? Using a two sample t-test to compare the means is standard. 
```{r Statistical Analysis 1}

#What does an average day on the Safari look like?
gathered_ride_waits %>% 
  filter(attraction == "safari") %>% 
  filter(wait != -999) %>% 
  mutate(time_of_day = substr(as.character(datetime),12,16)) %>% 
  group_by(ACT_or_POST, time_of_day) %>% 
  summarize(avg_wait = mean(wait)) %>% 
  ggplot(aes(time_of_day, avg_wait, color = ACT_or_POST, group = 1))+
  geom_point(alpha = 0.25)+
  scale_color_manual(values=c("red", "black"),
                     name = "Actual or Posted",
                     labels = c("Actual", "Posted"))+
  ggtitle("Kilimanjaro Safari Wait Times")

# Boxplot of wait times.
gathered_ride_waits %>% 
  filter(attraction == "safari") %>% 
  filter(wait != -999) %>% 
  mutate(time_of_day = substr(as.character(datetime),12,16)) %>% 
  group_by(ACT_or_POST) %>% 
  ggplot(aes(ACT_or_POST, wait, color = ACT_or_POST))+
  geom_boxplot()+
  scale_color_manual(values=c("red", "black"),
                     name = "Actual or Posted",
                     labels = c("Actual", "Posted"))+
  ggtitle("Kilimanjaro Safari Wait Times")

safari_waits_ACT<- ride_waits %>% 
  filter(attraction == "safari") %>% 
  filter(SACTMIN != -999)

safari_waits_POST<- ride_waits %>% 
  filter(attraction == "safari") %>% 
  filter(SPOSTMIN != -999)

# T - test of wait times posted and actually.
t.test(safari_waits_POST$SPOSTMIN, safari_waits_ACT$SACTMIN) #SIGNIFICANT!
```

The two sample t-test provides a p-value of 2.2e-16, so we reject the null hypothesis of equal means. The boxplots also show that mean posted waits are often greater than mean actual waits. 



